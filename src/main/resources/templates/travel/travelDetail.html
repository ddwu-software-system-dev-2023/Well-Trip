<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>블로그 글</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
</head>
<body>
<div class="p-5 mb-5 text-center</> bg-light">
    <h1 class="mb-3">여행 일정</h1>
    <h4 class="mb-3">상세 보기</h4>
</div>

<div class="container mt-5">
    <div class="row">
        <div class="col-lg-8">
            <article>
                <input type="hidden" id="article-id" th:value="${travel.id}">
                <header class="mb-4">
                    <h1 class="fw-bolder mb-1" th:text="${travel.country}"></h1>
                    <div class="text-muted fst-italic mb-2" th:text="|여행 시작 날짜 ${#temporals.format(travel.startDate, 'yyyy-MM-dd')}~|"></div>
                    <div class="text-muted fst-italic mb-2" th:text="|끝 날짜 ${#temporals.format(travel.endDate, 'yyyy-MM-dd')}|"></div>
                    여행자 목록
                    <div th:each="traveler : ${travelers}">
                        <span th:text="${traveler.id}"></span>
                    </div>

                    <div class="form-group">
                        <label for="traveler">여행자 추가</label>
                        <select name="traveler" id="traveler" class="form-control">
                            <option value="">여행자 선택</option>
                            <option th:each="user : ${users}"
                                    th:value="${user.id}"
                                    th:text="${user.firstName}" />
                        </select>
                        <button type="button" class="btn btn-primary"
                                th:onclick="'javascript:addTraveler('+${travel.id}+')'">여행자 추가</button>
                    </div>
                    <button type="button" class="btn btn-primary"
                            th:onclick="'javascript:add('+${travel.id}+')'">여행 일정 추가</button>
                </header>
                <section class="mb-5">
                    <table class="table table-striped">
                        <thead>
                        <tr>
                            <th>#</th>
                            <th>장소</th>
                            <th>start time</th>
                            <th>end time</th>
                            <th>memo</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="item : ${travel.plans}">
                            <td th:text="${item.id}"></td>
                            <td th:if="${item.place} != null" th:text="${item.place.name}"></td>
                            <td th:text="${item.startTime}"></td>
                            <td th:text="${item.endTime}"></td>
                            <td th:text="${item.memo}"></td>
                            <td><button type="button" class="btn btn-primary"
                                        th:onclick="'javascript:edit('+${item.id}+')'">수정</button></td>
                            <td><button type="button" class="btn btn-primary"
                                        th:onclick="'javascript:drop('+${travel.id}+ ',' +${item.id}+')'">삭제</button></td>
                        </tr>
                        </tbody>
                    </table>
                </section>
<!--                <button type="button" id="modify-btn"-->
<!--                        th:onclick="|location.href='@{/travels?id={articleId}(articleId=${article.id})}'|"-->
<!--                        class="btn btn-primary btn-sm">수정</button>-->
<!--                <button type="button" id="delete-btn"-->
<!--                        class="btn btn-secondary btn-sm">삭제</button>-->
            </article>
        </div>
    </div>
</div>

</body>
<script>
    function addTraveler(travelId) {
        var form = document.createElement("form");
        var numSelect = document.getElementById("traveler");
        var userId = numSelect.options[document.getElementById("traveler").selectedIndex].value;
        form.setAttribute("method", "post");
        form.setAttribute("action", "/travels/" + travelId + "/" + userId);
        document.body.appendChild(form);
        form.submit();
    }

    function add(travelId) {
        const link = "/travels/" + travelId + "/new";
        location.href = link;
    }

    function edit(planId) {
        const link = "/travels/" + planId + "/edit";
        location.href = link;
    }

    function drop(travelId, planId) {
        const link = "/travels/" + travelId + "/" + planId + "/delete";
        location.href = link;
    }

</script>
